FROM python:3.13-alpine3.22

RUN addgroup app && adduser -S -G app app

WORKDIR /app

RUN chown -R app:app /app

# Install essential build tools and OpenMP support
RUN apk add --no-cache \
    build-base \
    cmake \
    git \
    libgomp

COPY requirements.txt .

RUN pip install --upgrade pip setuptools wheel \
 && pip install -r requirements.txt

COPY . .

RUN export GOOGLE_APPLICATION_CREDENTIALS=$(pwd)/GCS-Storage-Credentials.json

EXPOSE 8000

USER app

CMD ./run_wsgi.sh
